# Phenotyping
qsub data_prep/prep_ukb_phenos.sh

rsync -avP uger:"florez_ukb_projects/ppgs-gxe/data/processed/ukb_phenos_raw.csv" ../data/processed/
rsync -avP uger:"florez_ukb_projects/ppgs-gxe/data/processed/ukb_phenos_unrelated.csv" ../data/processed/
rsync -avP uger:"florez_ukb_projects/ppgs-gxe/data/processed/ukb_phenos_panUKBB.csv" ../data/processed/
rsync -avP uger:"florez_ukb_projects/ppgs-gxe/data/processed/ukb_*_set.csv" ../data/processed/

# Genome-wide single-variant analyses
bm_arr=("hscrp_log" "hba1c" "ldl_statinadj" "tg_log" "alt_log" "ggt_log" "hdl" "alb" "lipA_log" "vitD" "apoA"  "apoB_statinadj"  "ast_log"  "chol_statinadj"  "creatinine"  "cysC_log"  "bilirubin_dir_log" "glu"  "shbg"  "bilirubin_tot_log")

for bm in ${bm_arr[@]}; do qsub -t 1-22 gwas/run_gwas.sh $bm; done

for bm in ${bm_arr[@]}; do qsub gwas/postprocess_gwas.sh ${bm}; done

# Generate and calculate pPGS

for bm in ${bm_arr[@]}; do qsub pgs/run_prset.sh ${bm}; done

# Optimize pPGS

qsub pgs/run_optimize_ppgs.sh

rsync -avP uger:florez_ukb_projects/ppgs-gxe/data/processed/pgs/ppgs_vec_df.rds ../data/processed/pgs/

#rsync -avP uger:"florez_ukb_projects/ppgs-gxe/data/processed/pgs/*.all_score" ../data/processed/pgs/
#rsync -avP uger:"florez_ukb_projects/ppgs-gxe/data/processed/pgs/*.snp" ../data/processed/pgs/

## Export PGS definitions (from UKB postprocessing and to All of Us platform)
#
#rsync -avP ../data/processed/pgs/optimized_*_params.csv uger:"florez_ukb_projects/ipgs/data/processed/pgs/"
#
#for bm in ${bm_arr[@]}; do pgs/export_pgs_weights.sh ${bm} mpgs; done
#for bm in ${bm_arr[@]}; do pgs/export_pgs_weights.sh bmi_${bm} ipgs; done
#for bm in ${bm_arr[@]}; do pgs/export_pgs_weights.sh ${bm}_vQTL vpgs; done
#
#rsync -avP uger:"florez_ukb_projects/ipgs/data/processed/pgs/*_pgs_weights_hg38.txt" ../data/processed/pgs/
#gsutil cp ../data/processed/pgs/optimized_*_params.csv gs://fc-secure-d88ec83d-c5e9-4ca4-8776-7b3f142893dc/pgs_weights/
#gsutil cp ../data/processed/pgs/*_pgs_weights_hg38.txt gs://fc-secure-d88ec83d-c5e9-4ca4-8776-7b3f142893dc/pgs_weights/
#gsutil cp ../data/processed/manuscript/all_ukb_pgs_test_res_df.rds gs://fc-secure-d88ec83d-c5e9-4ca4-8776-7b3f142893dc/results/
